<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <script>
            /* function fun(n, k) {
                console.log(k);
                return {
                    fun: function (m) {
                        return fun(m, n);
                    },
                };
            }
            var a = fun(0);
            a.fun(1);
            a.fun(2);
            a.fun(3);
            var b = fun(0).fun(1).fun(2).fun(3);
            var c = fun(0).fun(1);
            c.fun(2);
            c.fun(3); */

            /* var o={};
            o[0]=1;
            o['0']=2;
            console.log(o['0']);
            console.log(o[0]); */

            /* var b;
            var a=b={};
            b[0]=2;
            // b=null;
            console.log(a[0]); */

            /* var obj = {
                valueOf() {
                    return 1;
                },
                toString() {
                    return 2;
                },
            };

            var obj2 = {
                valueOf() {
                    return '1';
                },
                toString() {
                    return 2;
                },
            }; */

            /* let x = 5;
            function fn(x) {
                return function (y) {
                    console.log(y + ++x);
                };
            }
            let f = fn(6);
            f(7);
            fn(8)(9);
            f(10);
            console.log(x); */

            /* {
                let x=1;
                console.log(x);
            }
            console.log(x); */

            /* function x() {
                console.log(1);
            }
            console.log(x); */

            /* console.log(fn);
            {
                function fn() {
                    console.log(1);
                }
            } */

            /* {
                console.log(x); //f x(){console.log(2);}
                console.log(window.x); //undefined
                x = 0;
                x++;
                console.log(x); //1
                console.log(window.x); //undefined
                function x() {
                    console.log(1);
                }
                console.log(x); //1
                console.log(window.x); //1
                x++;
                console.log(x); //2
                console.log(window.x); //1
                function x() {
                    console.log(2);
                }
                console.log(x); //2
                console.log(window.x); //2
                x = 6;
                console.log(x); //6
                console.log(window.x); //2
            }
            console.log(x); //2 */

            /* var x = 2;
            var f = function () {
                x++;
            };
            var g = function (a) {
                var x = 1;
                a(x);
                console.log(x);  //1
            };
            g(f);
            console.log(x);  //3 */

            /* function f(
                x = function () {
                    y++;
                    console.log(y); //2
                },
                y = 1
            ) {
                var x;
                var y = 3;
                x();
                console.log(y); //3
            }
            f(); */

            /* var x = 1;
            function fn(
                x,
                y = function () {
                    x = 2;
                }
            ) {
                var x;
                y();
                console.log(x); //5
            }
            fn(5);
            console.log(x); //1 */

            /* var x = 1;
            function f(
                x = 2,
                y = function () {
                    x++;
                    console.log(x);
                }
            ) {
                console.log(x); //f x(){}
                function x() {}
                y(); //3
                console.log(x); //f x(){}
            }
            f();
            console.log(x); //1 */

            /* function f(y) {
                console.log(arguments[0]);  //1
                var x = arguments[0] = 2;
                console.log(y);  //2
                y = 3;
                console.log(arguments[0]);  //3
                console.log(x);  //2
            }
            f(1); */

            /* var a = 9;
            function fn() {
                a = 0;
                return function (b) {
                    return b + a++;
                };
            }
            var f = fn();
            console.log(f(5));
            console.log(fn()(5));
            console.log(f(5));
            console.log(a); */

            /* var a = 1;
            (function a() {
                a = 2;
                console.log(a);
            })();
            console.log(a); */

            /* function f() {
                console.log(f);
            }
            f(); //ƒ f() {console.log(f);} */

            /* function f(...args) {
                console.log(args);
            }
            f(1); */

            /* function fun(n, o) {
                console.log(o);
                return {
                    fun: function (m) {
                        return fun(m, n);
                    },
                };
            }
            var c = fun(0).fun(1);
            c.fun(2);
            c.fun(3); */

            /* function A() {
                this.x = 1;
            }
            var a = new A();
            console.log(A.prototype.isPrototypeOf(a)); //true */

            /* var arr = [1, 2, 3];
            var f = function () {console.log(1);};
            var arr2=['a'];
            var obj={'name':'js'} */
            // ---------------------------------------------------------------------------
            // ---------------------------------------------------------------------------

            // new源码
            /* function _new(Fn) {
                return function (...args) {
                    var obj = {};
                    obj.__proto__ = Fn.prototype;
                    var res = Fn.call(obj, ...args);
                    if (res !== null && /^(function|object)$/.test(typeof res)) {
                        return res;
                    } else {
                        return obj;
                    }
                };
            }
            function Fn(x, y) {
                this.x = x;
                this.y = y;
                // return {};
            }
            var fn = _new(Fn)(1, 2);
            console.log(fn); */

            /* function Fn() {
                this.x = 1;
            }
            var fn = new Fn();
            console.log(fn.__proto__); */

            /* function f() {}
            console.log(f.prototype); */

            // Object.create源码
            /* Object.create = function (prototype) {
                var Fn = function () {};
                Fn.prototype = prototype;
                return new Fn();
            }; */

            // 解决原型重定向后原来的原型上属性和方法丢失问题
            /* function Fn() {}
            Fn.prototype.a = 1;
            Fn.prototype.b = 2;
            var proto = Object.create(Fn.prototype);
            var newProto = {
                x: 1,
                f: function () {
                    console.log(1);
                },
            };
            proto = Object.assign(proto, newProto);
            Fn.prototype = proto; */

            // 深拷贝
            /* function deepCopy(obj) {
                var constructor = obj.constructor;
                if (obj === null) return null;
                if (typeof constructor !== "object") return obj;
                if (/^(RegExp|Date)$/i.test(constructor.name)) return new constructor(obj);
                var new_obj = new constructor();
                for (var key in obj) {
                    if (!obj.hasOwnProperty(key)) break;
                    new_obj[key] = deepCopy(obj[key]);
                }
                return new_obj;
            } */

            // 数据类型检测
            /* function checkType(obj) {
                var type = Object.prototype.toString.call(obj);
                return /^\[object ([a-zA-Z]+)\]$/.exec(type)[1].toLowerCase();
            } */

            // call源码
            /* Function.prototype._call = function (obj, ...args) {
                obj.fn = this;
                var res = obj.fn(...args);
                delete obj.fn;
                return res;
            }; */

            /* Function.prototype.call = function (obj, ...args) {
                if (obj == null) {
                    obj = window;
                }
                var objType = typeof obj;
                if (!/^(function|object)$/.test(objType)) {
                    obj = Object(obj);
                }
                var key = Symbol("key");
                obj[key] = this;
                var res = obj[key](...args);
                delete obj[key];
                return res;
            }; */

            // bind源码
            /* Function.prototype.bind = function (obj, ...args1) {
                var _this = this;
                return function (...args2) {
                    _this.call(obj, ...args1.concat(args2));
                };
            }; */

            // instanceof源码
            /* function _instanceof(obj, fn) {
                var prototype = fn.prototype;
                var proto = Object.getPrototypeOf(obj);
                while (true) {
                    if (proto === null) {
                        return false;
                    }
                    if (proto === prototype) {
                        return true;
                    }
                    proto = Object.getPrototypeOf(proto);
                }
            } */

            function fn() {
                console.log(1);
                return Promise.reject("error");
            }
            (async function () {
                setTimeout(() => {
                    console.log(3);
                });
                try {
                    Promise.resolve("promise").then((res) => console.log(res));
                    let value = await fn();
                    console.log("被await阻塞的代码执行了");
                    console.log(value);
                } catch {
                    console.log("fn失败");
                }
            })();
            console.log(4);
        </script>
    </body>
</html>
